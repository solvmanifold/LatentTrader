# Trading Advisor

A Python CLI tool for generating tactical swing trading advice based on technical indicators and analyst targets for S&P 500 stocks.

## Features

- Pulls historical stock data using `yfinance`
- Calculates various technical indicators:
  - RSI (Relative Strength Index)
  - MACD (Moving Average Convergence Divergence)
  - Bollinger Bands
  - Moving Averages (20, 50, 200-day)
- Incorporates analyst price targets
- Generates markdown-formatted reports with actionable trading playbooks
- Supports current position analysis
- Caches Ticker objects for performance
- Saves structured JSON data for programmatic analysis
- Normalized technical scores (0-10) for easy comparison
- Ranks top setups by confidence Ã— upside

## Installation

### From Source

1. Clone the repository:
   ```bash
   git clone https://github.com/solvmanifold/LatentTrader.git
   cd LatentTrader
   ```

2. Create and activate a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. Install the package in development mode:
   ```bash
   pip install -e .
   ```

### From PyPI (Coming Soon)

```bash
pip install trading-advisor
```

## Usage

### Analyze Stocks

```bash
trading-advisor analyze --tickers tickers.txt --positions positions.csv
```

Options:
- `--tickers`, `-t`: Path to a file containing ticker symbols (required)
- `--positions`, `-p`: Path to a CSV file containing positions (optional)
- `--positions-only`: Analyze only positions (optional)
- `--output`, `-o`: Path to the output JSON file (default: `output/analysis.json`)
- `--history-days`, `-d`: Number of days of historical data to analyze (default: 100)

### Generate Report

```bash
trading-advisor report --json output/analysis.json --output output/report.md
```

Options:
- `--json`, `-j`: Path to the JSON file generated by the analyze command (required)
- `--output`, `-o`: Path to the output markdown file (default: `output/report.md`)

### Generate Interactive Charts

```bash
trading-advisor chart AAPL --output-dir output/charts --days 100
```

Options:
- `--output-dir`, `-o`: Directory to save the charts (default: `output/charts`)
- `--days`, `-d`: Number of days of historical data to include (default: 100)

### JSON Output Structure

The `analyze` command outputs a JSON file with the following structure:

```json
{
  "timestamp": "2023-10-01T12:00:00",
  "positions": [
    {
      "ticker": "AAPL",
      "score": {
        "total": 8,
        "details": {
          "rsi": 70,
          "macd": 1.5
        }
      },
      "price_data": [
        {
          "Date": "2023-10-01",
          "Open": 150.0,
          "High": 155.0,
          "Low": 148.0,
          "Close": 152.0,
          "Volume": 1000000
        }
      ]
    }
  ],
  "new_picks": [
    {
      "ticker": "MSFT",
      "score": {
        "total": 6,
        "details": {
          "rsi": 60,
          "macd": 0.5
        }
      },
      "price_data": [
        {
          "Date": "2023-10-01",
          "Open": 200.0,
          "High": 205.0,
          "Low": 198.0,
          "Close": 202.0,
          "Volume": 2000000
        }
      ]
    }
  ]
}
```

### Report Output

The `report` command generates a markdown report with the following sections:

- **Current Positions**: Details for each position, including:
  - A concise summary line combining technical indicators and position details
  - Price and volume information
  - Technical indicators (RSI, MACD, Bollinger Bands, Moving Averages)
  - Analyst targets and technical score
  - Actionable recommendations (action, entry strategy, stop-loss, profit-taking, confidence, rationale)

- **New Technical Picks**: Details for each new pick, including:
  - A concise summary line combining technical indicators and price information
  - Volume information
  - Technical indicators (RSI, MACD, Bollinger Bands, Moving Averages)
  - Analyst targets and technical score
  - Actionable recommendations (action, entry strategy, stop-loss, profit-taking, confidence, rationale)

Example output format:
```
ðŸ“Š $TSLA â€” Current Position
ðŸ’¡ TSLA: Bullish MACD, RSI neutral, near upper band ($362.47), above 20d MA, volume spike ðŸ“ˆ Position: 7 shares @ $1983.80 | +21.3% | 6.8% of account
Price: $343.82 (5d: +0.5%)
ðŸ“ˆ Volume: +47.3% vs prev day â€” unusual activity
RSI: 68.4 â€” neutral
MACD: Bullish (Hist: +5.87) ðŸ“ˆ
BB: Near upper band ($362.47)
MA Trend: Bullish (20d) ðŸ“ˆ
Median analyst target: $296 â†’ -14.5% upside (range: $115â€“$465)
âž¡ï¸ Technical Score: 4.5/10
```

### Test Coverage

The CLI is now fully tested. See `tests/test_analyze_command.py` and `tests/test_report_command.py` for details.

## Requirements

- Python 3.8 or higher
- pandas >= 2.0.0
- numpy >= 1.24.0
- yfinance >= 0.2.36
- ta >= 0.10.0
- typer >= 0.9.0
- rich >= 13.0.0

## License

This project is licensed under the MIT License - see the LICENSE file for details. 